<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="products">

	<select id="getTotalRows" parameterType="map" resultType="int">
		SELECT
			COUNT(*)
		FROM
			toy_products
	</select>
	
	<select id="getTotalRowsWithSearching" parameterType="map" resultType="int">
		select
			count(*)
		from
			toy_products
		
		<where>
			 <choose>
		 		<when test="opt != null and opt == 'name'">
		 			product_name like '%' || #{keyword} || '%'
		 		</when>
		 		<when test="opt != null and opt == 'brand'">
		 			and product_ brand like '%' || #{keyword} || '%'
		 		</when>
		 	</choose>
		 </where>
	</select>
	
	
	
	<select id="getAllProducts2" resultType="com.toymarket.vo.Products">
		SELECT 
			product_no 					as no,
			category_no 				as categoryNo,
			product_brand 				as brand,
			product_name 				as name,
			product_price 				as price,
			product_discount_rate 		as discountRate,
			product_discount_YN 		as discountYN,
			product_like_count 			as likeCount,
			product_sell_unit 			as sellUnit,
			product_weight 				as weight,
			product_morning_delivery_YN as morningDeliveryYN,
			product_description 		as description,
			product_stock 				as stock,
			product_created_date 		as createdDate,
			product_status 				as status,
			product_image 				as image,
			product_sub_title 			as subTitle
		FROM 
			toy_products
	</select>
	<select id="getAllProducts"  parameterType="map" resultType="com.toymarket.vo.Products">
		SELECT 
			product_no 					as no,
			category_no 				as categoryNo,
			product_brand 				as brand,
			product_name 				as name,
			product_price 				as price,
			product_discount_rate 		as discountRate,
			product_discount_YN 		as discountYN,
			product_like_count 			as likeCount,
			product_sell_unit 			as sellUnit,
			product_weight 				as weight,
			product_morning_delivery_YN as morningDeliveryYN,
			product_description 		as description,
			product_stock 				as stock,
			product_created_date 		as createdDate,
			product_status 				as status,
			product_image 				as image,
			product_sub_title 			as subTitle
		FROM (
			SELECT
				<if test="sort == '신상품순'"> row_number() OVER (ORDER BY product_no DESC) rn,</if>
				<if test="sort == '인기상품순'"> row_number() OVER (ORDER BY product_like_count DESC) rn,</if>
				<if test="sort == '혜택순'"> row_number() OVER (ORDER BY product_discount_rate DESC) rn,</if>
				<if test="sort == '낮은가격순'"> row_number() OVER (ORDER BY product_price ASC) rn,</if>
				<if test="sort == '높은가격순'"> row_number() OVER (ORDER BY product_price DESC) rn,</if>
				product_no, category_no, product_brand, product_name, product_price, product_discount_rate, product_discount_YN,
				product_like_count, product_sell_unit, product_weight, product_morning_delivery_YN, product_description,
				product_stock, product_created_date, product_status, product_image, product_sub_title
			FROM toy_products
		
		)
		WHERE
			rn BETWEEN #{beginIndex} AND #{endIndex}	
	</select>
	<select id="getAllProductsWithCategory" resultType="com.toymarket.vo.Products">
		SELECT 
			product_no 					as no,
			category_no 				as categoryNo,
			product_brand 				as brand,
			product_name 				as name,
			product_price 				as price,
			product_discount_rate 		as discountRate,
			product_discount_YN 		as discountYN,
			product_like_count 			as likeCount,
			product_sell_unit 			as sellUnit,
			product_weight 				as weight,
			product_morning_delivery_YN as morningDeliveryYN,
			product_description 		as description,
			product_stock 				as stock,
			product_created_date 		as createdDate,
			product_status 				as status,
			product_image 				as image,
			product_sub_title 			as subTitle
		FROM 
			toy_products
		where
			category_no = #{value}
        
		ORDER BY product_no DESC	
	</select>
	
	<select id="getAllProductsList" parameterType="map" resultType="com.toymarket.vo.Products">
		SELECT 
			product_no 						as no,
			category_no 					as categoryNo,
			product_brand 					as brand,
			product_name 					as name,
			product_price 					as price,
			product_discount_rate 			as discountRate,
			product_discount_YN 			as discountYN,
			product_like_count 				as likeCount,
			product_sell_unit 				as sellUnit,
			product_weight 					as weight,
			product_morning_delivery_YN 	as morningDeliveryYN,
			product_description 			as description,
			product_stock 					as stock,
			product_created_date 			as createdDate,
			product_status 					as status,
			product_image 					as image,
			product_sub_title 				as subTitle
		FROM (
			select
				row_number() over (order by product_no desc) rn,
				product_no, category_no, product_brand, product_name, product_price, product_discount_rate, product_discount_YN, product_like_count,
				product_sell_unit, product_weight, product_morning_delivery_YN, product_description, product_stock, product_created_date, product_status,
				product_image, product_sub_title
			from 
				toy_products
				<where>
					<choose>
		 				<when test="opt != null and opt == 'name'">
		 						product_name like '%' || #{keyword} || '%'
		 				</when>
		 				<when test="opt != null and opt == 'brand'">
		 					and product_ brand like '%' || #{keyword} || '%'
		 				</when>
		 			</choose>
		 		</where>
		)
		where 
			rn between #{beginIndex} and #{endIndex}
	</select>
	
	<delete id="deleteById" parameterType="int">
		delete  toy_products
		where product_no = #{value}
	</delete>
	
	<select id="getProductDetail" parameterType="int" resultType="com.toymarket.vo.Products">
		SELECT
			product_no 					as no,
			category_no 				as categoryNo,
			product_brand 				as brand,
			product_name 				as name,
			product_price 				as price,
			product_discount_rate 		as discountRate,
			product_discount_YN 		as discountYN,
			product_like_count 			as likeCount,
			product_sell_unit 			as sellUnit,
			product_weight 				as weight,
			product_morning_delivery_YN as morningDeliveryYN,
			product_description 		as description,
			product_stock 				as stock,
			product_created_date 		as createdDate,
			product_status 				as status,
			product_image 				as image,
			product_sub_title 			as subTitle
		FROM
			toy_products
		WHERE
			product_no = #{value}
	</select>
	
	<select id="getCategory" resultType="com.toymarket.vo.Category">
		select
			category_no		as no
		from
			toy_categories
	</select>
	
	<update id="updateProducts" parameterType="Products">
		update toy_products
		set
			category_no				as no,
			product_brand			as brand,
			product_name 				as name,
			product_price 				as price,
			product_discount_rate 		as discountRate,
			product_discount_YN 		as discountYN,
			product_sell_unit 			as sellUnit,
			product_weight 				as weight,
			product_morning_delivery_YN as morningDeliveryYN,
			product_description 		as description,
			product_stock 				as stock,
			product_created_date 		as createdDate,
			product_status 				as status,
			product_image 				as image,
			product_sub_title 			as subTitle
			
	</update>
</mapper>