<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="productReview">

	<select id="getTotalRows" parameterType="map" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			toy_product_review R, toy_order_items I
		WHERE
			R.order_item_no = I.order_item_no
		AND
			I.product_no = #{productNo}
	</select>
	
	<select id="getReviewList" parameterType="map" resultType="com.toymarket.dto.ProductReviewDto">
		SELECT
			review_no 							as no,
			review_title						as title,
			review_content 						as content,
			review_created_date 				as createdDate,
			order_item_no 						as itemNo,
			product_no 							as productNo
		FROM (
			SELECT
				row_number() OVER (ORDER BY review_no DESC) RN,
				R.review_no, R.review_title, R.review_content, R.review_created_date, R.order_item_no, I.product_no
			FROM 
				toy_product_review R, toy_order_items I
			WHERE
				R.order_item_no = I.order_item_no
			AND
				I.product_no = #{productNo}
		)
		WHERE
			RN BETWEEN #{beginIndex} AND #{endIndex}
	</select>

	<insert id="insertReview" parameterType="com.toymarket.vo.ProductReview">
		INSERT INTO toy_product_review(
			review_no, review_title, review_content, review_created_date, order_item_no
		)
		VALUES (
			product_review_seq.nextval, #{title}, #{content}, #{createdDate}, #{itemNo}
		)
	</insert>
	
</mapper>